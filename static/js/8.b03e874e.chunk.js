(this["webpackJsonpbairro-admin"]=this["webpackJsonpbairro-admin"]||[]).push([[8,10],{170:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(15),c=(r(5),r(325)),i=r(333),a=r(301),s=r(299),o=r(300),d=r(297),l=function(e){var t=e.title,r=e.content,l=e.show,u=e.setShow,j=e.actionOnSuccess;return Object(n.jsx)(n.Fragment,{children:Object(n.jsxs)(i.a,{open:l,onClose:function(){return u(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(n.jsx)(d.a,{id:"alert-dialog-title",children:t}),r?Object(n.jsx)(s.a,{children:Object(n.jsx)(o.a,{id:"alert-dialog-description",children:r})}):null,Object(n.jsxs)(a.a,{children:[Object(n.jsx)(c.a,{onClick:function(){return u(!1)},color:"primary",children:"Cancel"}),Object(n.jsx)(c.a,{onClick:function(){j(),u(!1)},color:"primary",autoFocus:!0,children:"Ok"})]})]})})}},171:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(15),c=(r(5),r(183)),i=r(165),a=(r(172),function(e){var t=e.placeholder,r=(e.errors,e.name),a=e.control,s=e.options,o=e.title,d=(e.required,e.onChangeAction),l=e.defaultValue,u=e.multi;return Object(n.jsxs)("div",{style:{width:"100%",marginBottom:24},children:[Object(n.jsx)("p",{className:"Row-Title",children:o}),Object(n.jsx)(i.a,{control:a,style:{width:"100%",marginBottom:24},name:r,render:function(e){var r=e.onChange,i=(e.onBlur,e.value);e.name,e.ref;return Object(n.jsx)(c.a,{className:"Select",onChange:function(e){d&&d(e.value),r(e)},value:i,isMulti:u||!1,placeholder:t,options:s})},defaultValue:l?s.filter((function(e){return e.value===l}))[0]:null})]})})},172:function(e,t,r){},173:function(e,t,r){"use strict";r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return u})),r.d(t,"b",(function(){return j})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return O})),r.d(t,"a",(function(){return f})),r.d(t,"g",(function(){return h}));var n=r(313),c=(r(314),r(315),r(316)),i=r(317),a=r(327),s=r(326),o=r(335),d=r(331),l=function(e){return"string"===typeof e?Object(n.a)(e):e},u=function(e,t){return Object(c.a)(l(e),l(t))},j=function(e,t){return Object(i.a)(l(e),l(t))},b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return Object(a.a)(l(e),"yyyy".concat(t,"MM").concat(t,"dd"))},O=function(){return Object(s.a)(Object(a.a)(new Date,"yyyy-MM-dd"),"yyyy-MM-dd",new Date)},m=function(e){return Object(d.a)(e,"Asia/Tokyo")},f=function(e,t){var r=Object(o.a)(m(e),m(t));return h(r)},h=function(e){return[Math.floor(e/3600),Math.floor(e/60)%60,e%60].map((function(e){return e<10?"0"+e:e})).filter((function(e,t){return"00"!==e||t>0})).join(":")}},175:function(e,t,r){},186:function(e,t,r){},189:function(e,t,r){"use strict";r.r(t),r.d(t,"STATUS_NAMES",(function(){return f}));var n=r(4),c=r.n(n),i=r(52),a=r(15),s=r(5),o=r(19),d=r(51),l=r(29),u=r(165),j=r(71),b=r.n(j),O=(r(186),r(171)),m=(r(175),r(173)),f={"WAIT FOR CARD PAYMENT":"Wait for card payment",DELIVERING:"Ready to pick",ACCEPTED:"Picking",SENT:"Delivering",CLOSE:"Delivered",CANCELED:"Canceled"},h=function(e){var t=e.title,r=e.value,n=e.visible;return void 0===n||n?Object(a.jsxs)("div",{className:"Order-Item-Column",children:[Object(a.jsx)("p",{className:"Order-Item-Form-Title",children:t}),Object(a.jsx)("p",{className:"Order-Item-Form-Text",children:r})]}):null};t.default=Object(d.b)((function(e){return{singleOrder:e.orders.singleOrder,user:e.user.user}}),(function(e){return{fetchSingleOrder:function(t){return e(Object(l.b)(t))},fetchUpdateOrderStatus:function(t,r,n){return e(Object(l.c)(t,r,n))}}}))((function(e){var t,r,n,d,l,j,p=e.fetchSingleOrder,v=e.fetchUpdateOrderStatus,x=e.singleOrder,g=e.user,N=Object(o.i)(),y=Object(u.b)(),T=(y.register,y.handleSubmit),I=y.errors,S=y.setValue,C=y.control,D=N.params.orderId;console.log(x),Object(s.useEffect)((function(){p(D)}),[]);var w=!(null===x||void 0===x?void 0:x.status)||("picker"===g.type?"SENT"===x.status||"CLOSE"===x.status||"CANCELED"===x.status:"dispatcher"!==g.type||"CLOSE"===x.status||"CANCELED"===x.status);Object(s.useEffect)((function(){x&&S("status",{value:x.status,label:f[x.status]})}),[x]);var P=function(){var e=Object(i.a)(c.a.mark((function e(){var t,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=x.address.streetName.replace(" ","+"),r="https://www.google.com.ua/maps/place/".concat(t,"+").concat(x.address.streetNumber,"+Lisboa"),window.open(r);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return x?Object(a.jsxs)("div",{className:"Order-Item",children:[Object(a.jsxs)("div",{className:"Order-Item-Header",children:[Object(a.jsxs)("p",{className:"Order-Item-Header-Title",style:{display:"flex",flexDirection:"row"},children:["Order","  ","CARD"===x.paymentType&&Object(a.jsx)("p",{style:{color:"green",marginLeft:5},children:"PAID"})]}),Object(a.jsxs)("div",{className:"Order-Item-Header-Button",children:[(null===x||void 0===x?void 0:x.dateOfAccepted)&&Object(a.jsxs)("div",{style:{fontWeight:"bold"},children:["Time of picking - ",function(){if(!(null===x||void 0===x?void 0:x.dateOfAccepted))return null;var e=b()(x.dateOfAccepted),t=b()(x.date);return console.log(e.toDate()),console.log(t.toDate()),Object(m.a)(Object(m.f)(x.dateOfAccepted),Object(m.f)(x.date))}()]}),(null===x||void 0===x?void 0:x.dateOfClose)&&Object(a.jsxs)("div",{style:{fontWeight:"bold"},children:["Time of close - ",(null===x||void 0===x?void 0:x.dateOfClose)?Object(m.a)(Object(m.f)(x.dateOfClose),Object(m.f)(x.date)):null]})]})]}),Object(a.jsxs)("form",{className:"Order-Item-Form",onSubmit:T((function(e){console.log(e)})),children:[Object(a.jsxs)("div",{className:"Order-Item-Row",children:[Object(a.jsx)(h,{title:"Date",value:b()(x.date).format("DD/MM/YY HH:mm")}),Object(a.jsx)(h,{title:"Order number",value:x.orderNumber}),Object(a.jsx)("div",{className:"Order-Item-Column",children:Object(a.jsxs)("div",{style:{width:"100%"},children:["admin"===g.type||"picker"===g.type?Object(a.jsxs)("div",{children:[Object(a.jsx)("p",{className:"Order-Item-Form-Title",children:"Status"}),Object(a.jsx)(O.a,{placeholder:"Status",name:"status",options:[{_id:"DELIVERING",name:"Ready to pick"},{_id:"ACCEPTED",name:"Picking"},{_id:"SENT",name:"Delivering"},{_id:"CLOSE",name:"Delivered"},{_id:"CANCELED",name:"Canceled"}].map((function(e){return{value:e._id,label:e.name}})),errors:I,control:C,onChangeAction:function(e){return v(x._id,e,x.userId)},required:{required:!0}})]}):Object(a.jsxs)("div",{children:[Object(a.jsx)("p",{className:"Order-Item-Form-Title",children:"Status"}),Object(a.jsx)("p",{className:"Order-Item-Form-Text",children:f[x.status]})]}),("picker"===g.type||"dispatcher"===g.type)&&Object(a.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",opacity:w?.4:1,cursor:w?void 0:"pointer"},onClick:w?function(){}:function(){"picker"===g.type&&v(x._id,"SENT",x.userId),"dispatcher"===g.type&&v(x._id,"CLOSE",x.userId)},children:Object(a.jsxs)("div",{style:{border:"2px solid #c700cb",borderRadius:10,padding:7,width:"100%",color:"#c700cb"},children:["picker"===g.type&&"Picked","dispatcher"===g.type&&"Delivered"]})})]})})]}),Object(a.jsxs)("div",{className:"Order-Item-Row",children:[Object(a.jsx)(h,{title:"Payment type",value:x.paymentType}),Object(a.jsx)(h,{title:"Subtotal",value:function(){if(x.promocode&&x.promocode.discount){if(!x.promocode.type||"CASH"===x.promocode.type){var e,t=null!==(e=x.price+x.promocode.discount)&&void 0!==e?e:0;return"".concat(t.toFixed(2)," \u20ac")}var r=100*x.price/(100-x.promocode.discount);return"".concat(r.toFixed(2)," \u20ac")}return"".concat(x.price.toFixed(2)," \u20ac")}()}),Object(a.jsx)(h,{title:"Total",value:"".concat(null===(t=x.price)||void 0===t?void 0:t.toFixed(2)," \u20ac")}),Object(a.jsx)(h,{title:"Promocode",value:(null===(r=x.promocode)||void 0===r?void 0:r.code)?"admin"===g.type?x.promocode.code:"Used":"None"})]}),Object(a.jsxs)("div",{className:"Order-Item-Row",children:[Object(a.jsx)(h,{title:"NIF",value:null===x||void 0===x?void 0:x.nif,visible:!!(null===x||void 0===x?void 0:x.nif)}),Object(a.jsx)(h,{title:"User Name",value:x.userName,visible:!!x.userName}),Object(a.jsx)(h,{title:"Phone Number",value:x.phoneNumber,visible:!!x.phoneNumber}),Object(a.jsx)(h,{title:"Comment",value:(null===(n=x.address)||void 0===n?void 0:n.comment)?x.address.comment:"Not added"})]}),Object(a.jsx)("p",{className:"Order-Item-Form-Main",style:{marginBottom:30,marginTop:50},children:"ADDRESS"}),Object(a.jsxs)("div",{className:"Order-Item-Row",children:[Object(a.jsx)(h,{title:"Street Name",value:(null===(d=x.address)||void 0===d?void 0:d.streetName)?x.address.streetName:"Not added"}),Object(a.jsx)(h,{title:"Street Number",value:(null===(l=x.address)||void 0===l?void 0:l.streetNumber)?x.address.streetNumber:"Not added"}),Object(a.jsx)(h,{title:"Floor",value:(null===(j=x.address)||void 0===j?void 0:j.floor)?x.address.floor:"Not added"})]}),Object(a.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginBottom:25,cursor:"pointer"},onClick:P,children:Object(a.jsx)("div",{style:{border:"2px solid #c700cb",borderRadius:10,padding:7,color:"#c700cb"},children:"Show on maps"})}),Object(a.jsx)("p",{className:"Order-Item-Form-Main",children:"Products"}),Object(a.jsxs)("table",{className:"Orders-Table",children:[Object(a.jsx)("thead",{children:Object(a.jsxs)("tr",{children:[Object(a.jsx)("th",{children:"Image"}),Object(a.jsx)("th",{children:"Title"}),Object(a.jsx)("th",{children:"Storage Info"}),Object(a.jsx)("th",{children:"Count"}),Object(a.jsx)("th",{children:"Price"}),Object(a.jsx)("th",{children:"Priority"})]})}),Object(a.jsx)("tbody",{children:x.products?x.products.sort((function(e,t){var r=e.priority||0,n=t.priority||0;return r<n?-1:r>n?1:0})).map((function(e,t){return e.price?Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)("tr",{children:[Object(a.jsx)("td",{align:"left",children:Object(a.jsx)("img",{src:e.images[0],alt:"",className:"Orders-Table-Image"})}),Object(a.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.title_pt}),Object(a.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.storage_info}),Object(a.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.count}),Object(a.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.price.current.toFixed(2)}),Object(a.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.priority||0})]})}):null})):null})]})]})]}):null}))},194:function(e,t,r){"use strict";var n=r(41),c=r(5),i=r(19);t.a=function(e){var t=new URLSearchParams(Object(i.h)().search),r=Object(i.g)(),a=Object(c.useState)(null),s=Object(n.a)(a,2),o=s[0],d=s[1],l=Object(c.useState)(0),u=Object(n.a)(l,2),j=u[0],b=u[1],O=Object(c.useState)(!1),m=Object(n.a)(O,2),f=m[0],h=m[1],p=Object(c.useState)(0),v=Object(n.a)(p,2),x=v[0],g=v[1],N=Object(c.useState)([]),y=Object(n.a)(N,2),T=y[0],I=y[1];Object(c.useEffect)((function(){if(t&&!f){var e=t.get("page"),r=Number(e);b(isNaN(r)?0:r>0?r-1:r),h(!0)}}),[t,f]),Object(c.useEffect)((function(){if(e.countItems){d(null);var t=e.countItems/e.maxItemsOnPage;if(j>t)return void b(0);for(var r=j*e.maxItemsOnPage+e.maxItemsOnPage,n=j*e.maxItemsOnPage,c=r>e.countItems?e.countItems-1:r,i=[],a=0;a<t;a++)i.push(a+1);g(Number(t.toFixed(0))),I(i),d({begin:n,end:c})}}),[j,e.maxItemsOnPage,e.countItems]);return{actions:{setPage:function(t){r.push("".concat(e.baseUrl,"?page=").concat(t)),h(!1)}},loading:!o,page:j,indexes:o,countPages:x,arrayPages:T}}},195:function(e,t,r){"use strict";var n=r(15);r(5),r(196);t.a=function(e){return Object(n.jsx)("div",{className:"Pagination-Wrapper",children:e.pages.map((function(t){return Object(n.jsx)("div",{className:"Pagination-Block",style:{opacity:t-1===e.selectedPage?1:.3},onClick:function(){return e.onChange(t)},children:t})}))})}},196:function(e,t,r){},197:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(4),c=r.n(n),i=r(2),a=r(52),s=r(10),o=function(){var e=Object(a.a)(c.a.mark((function e(t){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.b.collection("promocode").doc(t).get().then((function(e){return Object(i.a)({_id:e.id},e.data())}));case 2:return r=e.sent,e.abrupt("return",null!==r&&void 0!==r?r:t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},259:function(e,t,r){},312:function(e,t,r){"use strict";r.r(t);var n=r(176),c=r(4),i=r.n(c),a=r(52),s=r(41),o=r(15),d=r(5),l=r(51),u=r(21),j=r(19),b=(r(259),r(170)),O=r(29),m=r(71),f=r.n(m),h=r(194),p=r(195),v=r(197),x=r(189),g=r(10),N={CARD:"CARD",CASH:"Pagar no ato de entrega",MBWAY:"MBWAY"};t.default=Object(l.b)((function(e){return{orders:e.orders.orders,user:e.user.user}}),(function(e){return{fetchAllOrders:function(){return e(Object(O.a)())},fetchDeleteCategory:function(t){return e(Object(u.c)(t))}}}))((function(e){var t,r=e.orders,c=e.user,l=e.fetchAllOrders,u=e.fetchDeleteCategory,O=Object(j.g)(),m=Object(d.useState)(!1),y=Object(s.a)(m,2),T=y[0],I=y[1],S=Object(d.useState)(0),C=Object(s.a)(S,2),D=C[0],w=(C[1],Object(d.useState)([])),P=Object(s.a)(w,2),E=P[0],A=P[1],k=Object(d.useState)([]),F=Object(s.a)(k,2),M=F[0],_=F[1],R=Object(h.a)({maxItemsOnPage:50,countItems:null!==(t=null===r||void 0===r?void 0:r.length)&&void 0!==t?t:0,baseUrl:"/cabinet/orders"}),L=R.actions,H=R.page,B=R.loading,U=R.indexes,W=R.arrayPages;Object(d.useEffect)((function(){g.b.collection("orders").onSnapshot((function(e){l()}))}),[]);console.log(E);var Y=function(){var e=Object(a.a)(i.a.mark((function e(t,r){var c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _((function(e){return[].concat(Object(n.a)(e),[{orderId:t}])})),e.next=3,Object(v.a)(r);case 3:c=e.sent,A((function(e){var r;return[].concat(Object(n.a)(e),[{orderId:t,code:null!==(r=c.code)&&void 0!==r?r:"Promocode deleted"}])}));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(b.a,{title:"Do you want delete this category?",show:T,actionOnSuccess:function(){return u(r[D]._id)},setShow:I}),Object(o.jsxs)("div",{className:"Orders",children:[Object(o.jsxs)("div",{className:"Orders-Header",children:[Object(o.jsx)("div",{className:"Orders-Header-Button"}),Object(o.jsx)("p",{className:"Orders-Header-Title",children:"Orders"}),Object(o.jsx)("div",{className:"Orders-Header-Button"})]}),Object(o.jsxs)("table",{className:"Orders-Table",style:{marginBottom:15},children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{children:"Date"}),Object(o.jsx)("th",{children:"Order number"}),Object(o.jsx)("th",{children:"Status"}),Object(o.jsx)("th",{children:"Products Count"}),Object(o.jsx)("th",{children:"Price"}),Object(o.jsx)("th",{children:"Promocode"}),Object(o.jsx)("th",{children:"Payment Type"})]})}),Object(o.jsx)("tbody",{children:r&&!B?r.slice(null===U||void 0===U?void 0:U.begin,null===U||void 0===U?void 0:U.end).map((function(e,t){var r,n,i,a,s;return Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)("tr",{onClick:function(){return O.push("/cabinet/orders/".concat(e._id))},children:[Object(o.jsx)("td",{className:"Orders-Table-Title",align:"left",children:f()(e.date).utcOffset(1,!1).format("DD/MM/YY HH:mm")}),Object(o.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.orderNumber}),Object(o.jsx)("td",{className:"Orders-Table-Title",align:"left",children:x.STATUS_NAMES[e.status]}),Object(o.jsx)("td",{className:"Orders-Table-Title",align:"left",children:null!==(r=null===(n=e.products)||void 0===n?void 0:n.length)&&void 0!==r?r:0}),Object(o.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.price.toFixed(2)}),Object(o.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.promocode?"admin"===c.type?E.some((function(t){return t.orderId===e._id}))?null===(i=E.find((function(t){return t.orderId===e._id})))||void 0===i?void 0:i.code:(a=e._id,s=e.promocode,M.some((function(e){return e.orderId===a}))||Y(a,s)," "):"Used":"None"}),Object(o.jsx)("td",{className:"Orders-Table-Title",align:"left",children:N[e.paymentType]})]})})})):null})]}),Object(o.jsx)(p.a,{pages:W,selectedPage:H,onChange:function(e){_([]),A([]),L.setPage(e)}})]})]})}))}}]);
//# sourceMappingURL=8.b03e874e.chunk.js.map