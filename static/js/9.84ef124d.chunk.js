(this["webpackJsonpbairro-admin"]=this["webpackJsonpbairro-admin"]||[]).push([[9,10],{171:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var c=r(15),n=(r(5),r(183)),s=r(165),i=(r(172),function(e){var t=e.placeholder,r=(e.errors,e.name),i=e.control,a=e.options,d=e.title,o=(e.required,e.onChangeAction),l=e.defaultValue,u=e.multi;return Object(c.jsxs)("div",{style:{width:"100%",marginBottom:24},children:[Object(c.jsx)("p",{className:"Row-Title",children:d}),Object(c.jsx)(s.a,{control:i,style:{width:"100%",marginBottom:24},name:r,render:function(e){var r=e.onChange,s=(e.onBlur,e.value);e.name,e.ref;return Object(c.jsx)(n.a,{className:"Select",onChange:function(e){o&&o(e.value),r(e)},value:s,isMulti:u||!1,placeholder:t,options:a})},defaultValue:l?a.filter((function(e){return e.value===l}))[0]:null})]})})},172:function(e,t,r){},173:function(e,t,r){"use strict";r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return u})),r.d(t,"b",(function(){return j})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return O})),r.d(t,"a",(function(){return f})),r.d(t,"g",(function(){return p}));var c=r(313),n=(r(314),r(315),r(316)),s=r(317),i=r(327),a=r(326),d=r(335),o=r(331),l=function(e){return"string"===typeof e?Object(c.a)(e):e},u=function(e,t){return Object(n.a)(l(e),l(t))},j=function(e,t){return Object(s.a)(l(e),l(t))},b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return Object(i.a)(l(e),"yyyy".concat(t,"MM").concat(t,"dd"))},O=function(){return Object(a.a)(Object(i.a)(new Date,"yyyy-MM-dd"),"yyyy-MM-dd",new Date)},m=function(e){return Object(o.a)(e,"Asia/Tokyo")},f=function(e,t){var r=Object(d.a)(m(e),m(t));return p(r)},p=function(e){return[Math.floor(e/3600),Math.floor(e/60)%60,e%60].map((function(e){return e<10?"0"+e:e})).filter((function(e,t){return"00"!==e||t>0})).join(":")}},175:function(e,t,r){},186:function(e,t,r){},189:function(e,t,r){"use strict";r.r(t),r.d(t,"STATUS_NAMES",(function(){return f}));var c=r(4),n=r.n(c),s=r(52),i=r(15),a=r(5),d=r(19),o=r(51),l=r(29),u=r(165),j=r(71),b=r.n(j),O=(r(186),r(171)),m=(r(175),r(173)),f={"WAIT FOR CARD PAYMENT":"Wait for card payment",DELIVERING:"Ready to pick",ACCEPTED:"Picking",SENT:"Delivering",CLOSE:"Delivered",CANCELED:"Canceled"},p=function(e){var t=e.title,r=e.value,c=e.visible;return void 0===c||c?Object(i.jsxs)("div",{className:"Order-Item-Column",children:[Object(i.jsx)("p",{className:"Order-Item-Form-Title",children:t}),Object(i.jsx)("p",{className:"Order-Item-Form-Text",children:r})]}):null};t.default=Object(o.b)((function(e){return{singleOrder:e.orders.singleOrder,user:e.user.user}}),(function(e){return{fetchSingleOrder:function(t){return e(Object(l.b)(t))},fetchUpdateOrderStatus:function(t,r,c){return e(Object(l.c)(t,r,c))}}}))((function(e){var t,r,c,o,l,j,h=e.fetchSingleOrder,v=e.fetchUpdateOrderStatus,x=e.singleOrder,N=e.user,y=Object(d.i)(),g=Object(u.b)(),T=(g.register,g.handleSubmit),S=g.errors,C=g.setValue,w=g.control,D=y.params.orderId;console.log(x),Object(a.useEffect)((function(){h(D)}),[]);var E=!(null===x||void 0===x?void 0:x.status)||("picker"===N.type?"SENT"===x.status||"CLOSE"===x.status||"CANCELED"===x.status:"dispatcher"!==N.type||"CLOSE"===x.status||"CANCELED"===x.status);Object(a.useEffect)((function(){x&&C("status",{value:x.status,label:f[x.status]})}),[x]);var A=function(){var e=Object(s.a)(n.a.mark((function e(){var t,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=x.address.streetName.replace(" ","+"),r="https://www.google.com.ua/maps/place/".concat(t,"+").concat(x.address.streetNumber,"+Lisboa"),window.open(r);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return x?Object(i.jsxs)("div",{className:"Order-Item",children:[Object(i.jsxs)("div",{className:"Order-Item-Header",children:[Object(i.jsxs)("p",{className:"Order-Item-Header-Title",style:{display:"flex",flexDirection:"row"},children:["Order","  ","CARD"===x.paymentType&&Object(i.jsx)("p",{style:{color:"green",marginLeft:5},children:"PAID"})]}),Object(i.jsxs)("div",{className:"Order-Item-Header-Button",children:[(null===x||void 0===x?void 0:x.dateOfAccepted)&&Object(i.jsxs)("div",{style:{fontWeight:"bold"},children:["Time of picking - ",function(){if(!(null===x||void 0===x?void 0:x.dateOfAccepted))return null;var e=b()(x.dateOfAccepted),t=b()(x.date);return console.log(e.toDate()),console.log(t.toDate()),Object(m.a)(Object(m.f)(x.dateOfAccepted),Object(m.f)(x.date))}()]}),(null===x||void 0===x?void 0:x.dateOfClose)&&Object(i.jsxs)("div",{style:{fontWeight:"bold"},children:["Time of close - ",(null===x||void 0===x?void 0:x.dateOfClose)?Object(m.a)(Object(m.f)(x.dateOfClose),Object(m.f)(x.date)):null]})]})]}),Object(i.jsxs)("form",{className:"Order-Item-Form",onSubmit:T((function(e){console.log(e)})),children:[Object(i.jsxs)("div",{className:"Order-Item-Row",children:[Object(i.jsx)(p,{title:"Date",value:b()(x.date).format("DD/MM/YY HH:mm")}),Object(i.jsx)(p,{title:"Order number",value:x.orderNumber}),Object(i.jsx)("div",{className:"Order-Item-Column",children:Object(i.jsxs)("div",{style:{width:"100%"},children:["admin"===N.type||"picker"===N.type?Object(i.jsxs)("div",{children:[Object(i.jsx)("p",{className:"Order-Item-Form-Title",children:"Status"}),Object(i.jsx)(O.a,{placeholder:"Status",name:"status",options:[{_id:"DELIVERING",name:"Ready to pick"},{_id:"ACCEPTED",name:"Picking"},{_id:"SENT",name:"Delivering"},{_id:"CLOSE",name:"Delivered"},{_id:"CANCELED",name:"Canceled"}].map((function(e){return{value:e._id,label:e.name}})),errors:S,control:w,onChangeAction:function(e){return v(x._id,e,x.userId)},required:{required:!0}})]}):Object(i.jsxs)("div",{children:[Object(i.jsx)("p",{className:"Order-Item-Form-Title",children:"Status"}),Object(i.jsx)("p",{className:"Order-Item-Form-Text",children:f[x.status]})]}),("picker"===N.type||"dispatcher"===N.type)&&Object(i.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",opacity:E?.4:1,cursor:E?void 0:"pointer"},onClick:E?function(){}:function(){"picker"===N.type&&v(x._id,"SENT",x.userId),"dispatcher"===N.type&&v(x._id,"CLOSE",x.userId)},children:Object(i.jsxs)("div",{style:{border:"2px solid #c700cb",borderRadius:10,padding:7,width:"100%",color:"#c700cb"},children:["picker"===N.type&&"Picked","dispatcher"===N.type&&"Delivered"]})})]})})]}),Object(i.jsxs)("div",{className:"Order-Item-Row",children:[Object(i.jsx)(p,{title:"Payment type",value:x.paymentType}),Object(i.jsx)(p,{title:"Subtotal",value:function(){if(x.promocode&&x.promocode.discount){if(!x.promocode.type||"CASH"===x.promocode.type){var e,t=null!==(e=x.price+x.promocode.discount)&&void 0!==e?e:0;return"".concat(t.toFixed(2)," \u20ac")}var r=100*x.price/(100-x.promocode.discount);return"".concat(r.toFixed(2)," \u20ac")}return"".concat(x.price.toFixed(2)," \u20ac")}()}),Object(i.jsx)(p,{title:"Total",value:"".concat(null===(t=x.price)||void 0===t?void 0:t.toFixed(2)," \u20ac")}),Object(i.jsx)(p,{title:"Promocode",value:(null===(r=x.promocode)||void 0===r?void 0:r.code)?"admin"===N.type?x.promocode.code:"Used":"None"})]}),Object(i.jsxs)("div",{className:"Order-Item-Row",children:[Object(i.jsx)(p,{title:"NIF",value:null===x||void 0===x?void 0:x.nif,visible:!!(null===x||void 0===x?void 0:x.nif)}),Object(i.jsx)(p,{title:"User Name",value:x.userName,visible:!!x.userName}),Object(i.jsx)(p,{title:"Phone Number",value:x.phoneNumber,visible:!!x.phoneNumber}),Object(i.jsx)(p,{title:"Comment",value:(null===(c=x.address)||void 0===c?void 0:c.comment)?x.address.comment:"Not added"})]}),Object(i.jsx)("p",{className:"Order-Item-Form-Main",style:{marginBottom:30,marginTop:50},children:"ADDRESS"}),Object(i.jsxs)("div",{className:"Order-Item-Row",children:[Object(i.jsx)(p,{title:"Street Name",value:(null===(o=x.address)||void 0===o?void 0:o.streetName)?x.address.streetName:"Not added"}),Object(i.jsx)(p,{title:"Street Number",value:(null===(l=x.address)||void 0===l?void 0:l.streetNumber)?x.address.streetNumber:"Not added"}),Object(i.jsx)(p,{title:"Floor",value:(null===(j=x.address)||void 0===j?void 0:j.floor)?x.address.floor:"Not added"})]}),Object(i.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",marginBottom:25,cursor:"pointer"},onClick:A,children:Object(i.jsx)("div",{style:{border:"2px solid #c700cb",borderRadius:10,padding:7,color:"#c700cb"},children:"Show on maps"})}),Object(i.jsx)("p",{className:"Order-Item-Form-Main",children:"Products"}),Object(i.jsxs)("table",{className:"Orders-Table",children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"Image"}),Object(i.jsx)("th",{children:"Title"}),Object(i.jsx)("th",{children:"Storage Info"}),Object(i.jsx)("th",{children:"Count"}),Object(i.jsx)("th",{children:"Price"}),Object(i.jsx)("th",{children:"Priority"})]})}),Object(i.jsx)("tbody",{children:x.products?x.products.sort((function(e,t){var r=e.priority||0,c=t.priority||0;return r<c?-1:r>c?1:0})).map((function(e,t){return e.price?Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{align:"left",children:Object(i.jsx)("img",{src:e.images[0],alt:"",className:"Orders-Table-Image"})}),Object(i.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.title_pt}),Object(i.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.storage_info}),Object(i.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.count}),Object(i.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.price.current.toFixed(2)}),Object(i.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.priority||0})]})}):null})):null})]})]})]}):null}))},197:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var c=r(4),n=r.n(c),s=r(2),i=r(52),a=r(10),d=function(){var e=Object(i.a)(n.a.mark((function e(t){var r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.b.collection("promocode").doc(t).get().then((function(e){return Object(s.a)({_id:e.id},e.data())}));case 2:return r=e.sent,e.abrupt("return",null!==r&&void 0!==r?r:t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},262:function(e,t,r){},319:function(e,t,r){"use strict";r.r(t);var c=r(4),n=r.n(c),s=r(2),i=r(52),a=r(41),d=r(15),o=r(5),l=r(51),u=r(21),j=r(19),b=r(173),O=(r(262),r(29)),m=r(71),f=r.n(m),p=r(197),h=r(189);t.default=Object(l.b)((function(e){return{orders:e.orders.orders}}),(function(e){return{fetchAllOrders:function(){return e(Object(O.a)())},fetchDeleteCategory:function(t){return e(Object(u.c)(t))}}}))((function(e){var t=e.orders,r=e.fetchAllOrders,c=(e.fetchDeleteCategory,Object(j.i)(),Object(j.g)()),l=Object(o.useState)(!1),u=Object(a.a)(l,2),O=(u[0],u[1],Object(o.useState)(0)),m=Object(a.a)(O,2),v=(m[0],m[1],Object(o.useState)(Object(b.d)(Object(b.e)(),"-"))),x=Object(a.a)(v,2),N=x[0],y=x[1],g=Object(o.useState)([]),T=Object(a.a)(g,2),S=T[0],C=T[1],w=Object(o.useState)(0),D=Object(a.a)(w,2),E=D[0],A=D[1],I=Object(o.useState)(0),M=Object(a.a)(I,2),R=M[0],F=M[1];console.log(S);var L=function(){var e=Object(i.a)(n.a.mark((function e(){var r,c,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.filter((function(e){if("CANCELED"===e.status)return!1;var t=f()(e.date).utcOffset(1,!1).format("YYYY-MM-DD").split("-"),r=N.split("-");return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]})),c=[],e.next=4,Promise.all(r.map(function(){var e=Object(i.a)(n.a.mark((function e(t){var r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.promocode){e.next=6;break}return e.next=3,Object(p.a)(t.promocode);case 3:return r=e.sent,c.push(Object(s.a)(Object(s.a)({},t),{},{promocode:r})),e.abrupt("return");case 6:c.push(Object(s.a)(Object(s.a)({},t),{},{promocode:null}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:C(c),a={card:0,cash:0},c.forEach((function(e){var t=e.price;e.promocode&&(console.log(e.promocode.discount),t+=e.promocode.discount),"CARD"!==e.paymentType&&"MBWAY"!==e.paymentType||(a.card+=t>0?t:0),"CASH"===e.paymentType&&(a.cash+=t>0?t:0)})),A(a.card),F(a.cash);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(o.useEffect)((function(){r()}),[]),Object(o.useEffect)((function(){N&&t&&(C([]),L())}),[N,t]);var k=function(e){if(e.promocode&&e.promocode.discount){if(!e.promocode.type||"CASH"===e.promocode.type){var t,r=null!==(t=e.price+e.promocode.discount)&&void 0!==t?t:0;return"".concat(r.toFixed(2)," \u20ac")}var c=100*e.price/(100-e.promocode.discount);return"".concat(c.toFixed(2)," \u20ac")}return"".concat(e.price.toFixed(2)," \u20ac")};return Object(d.jsx)(d.Fragment,{children:Object(d.jsxs)("div",{className:"Orders",children:[Object(d.jsxs)("div",{className:"Orders-Header",children:[Object(d.jsx)("div",{className:"Orders-Header-Button"}),Object(d.jsx)("p",{className:"Orders-Header-Title",children:"Daily orders statistics"}),Object(d.jsx)("div",{className:"Orders-Header-Button"})]}),Object(d.jsxs)("div",{className:"Orders-Middle-Stats",children:[Object(d.jsx)("input",{type:"date",className:"Orders-Middle-Stats-Date",value:N,onChange:function(e){return t=e.target.value,y(t);var t}}),Object(d.jsxs)("div",{className:"Orders-Middle-Stats-Labels",children:[Object(d.jsxs)("div",{className:"Orders-Middle-Stats-Labels-Row",children:[Object(d.jsx)("div",{className:"Orders-Middle-Stats-Labels-Row-Title",children:"ORDERS COUNT"}),Object(d.jsx)("div",{children:S.length})]}),Object(d.jsxs)("div",{className:"Orders-Middle-Stats-Labels-Row",children:[Object(d.jsx)("div",{className:"Orders-Middle-Stats-Labels-Row-Title",children:"BY CASH"}),Object(d.jsxs)("div",{children:[R.toFixed(2)," \u20ac"]})]}),Object(d.jsxs)("div",{className:"Orders-Middle-Stats-Labels-Row",children:[Object(d.jsx)("div",{className:"Orders-Middle-Stats-Labels-Row-Title",children:"BY CARD"}),Object(d.jsxs)("div",{children:[E.toFixed(2)," \u20ac"]})]}),Object(d.jsxs)("div",{className:"Orders-Middle-Stats-Labels-Row",children:[Object(d.jsx)("div",{className:"Orders-Middle-Stats-Labels-Row-Title",children:"TOTAL"}),Object(d.jsxs)("div",{children:[(E+R).toFixed(2)," \u20ac"]})]})]})]}),Object(d.jsxs)("table",{className:"Orders-Table",children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{children:"Order number"}),Object(d.jsx)("th",{children:"Date"}),Object(d.jsx)("th",{children:"Status"}),Object(d.jsx)("th",{children:"Phone"}),Object(d.jsx)("th",{children:"Payment type"}),Object(d.jsx)("th",{children:"Price"})]})}),Object(d.jsx)("tbody",{children:S&&S.sort((function(e,t){return t.orderNumber-e.orderNumber})).map((function(e){var t;return Object(d.jsx)(d.Fragment,{children:Object(d.jsxs)("tr",{onMouseDown:function(t){return 1===t.button&&window.open("/cabinet/orders/".concat(e._id),"_blank")},onClick:function(){return c.push("/cabinet/orders/".concat(e._id))},children:[Object(d.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.orderNumber}),Object(d.jsx)("td",{className:"Orders-Table-Title",align:"left",children:f()(e.date).utcOffset(1,!1).format("DD/MM/YY HH:mm")}),Object(d.jsx)("td",{className:"Orders-Table-Title",align:"left",children:h.STATUS_NAMES[e.status]}),Object(d.jsx)("td",{className:"Orders-Table-Title",align:"left",children:null!==(t=e.phoneNumber)&&void 0!==t?t:"Phone number empty"}),Object(d.jsx)("td",{className:"Orders-Table-Title",align:"left",children:e.paymentType}),Object(d.jsx)("td",{className:"Orders-Table-Title",align:"left",children:k(e)})]})})}))})]})]})})}))}}]);
//# sourceMappingURL=9.84ef124d.chunk.js.map